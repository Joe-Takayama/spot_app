{% load static %}
<link href="{% static 'css/review_detail.css' %}" rel="stylesheet">

<div class="page">
  {% block body %}
  <div class="review-list">
    <h1 class="spot-name">{{ spot.spot_name }}</h1>

    {# ここ：spot.review_set.all → viewsから渡す reviews を使う #}
    {% for review in reviews %}
      <div class="review">
        <strong>★{{ review.rating }}</strong><br>
        {{ review.comment }}<br>
        <small>{{ review.posted_at|date:"Y/m/d" }}</small>

        {% if user.is_authenticated and review.user == user %}
          <form method="post" action="{% url 'spotapp:review_delete' review.review_id %}">
            {% csrf_token %}
            <button type="submit" class="delete-btn">削除</button>
          </form>
        {% endif %}
      </div>
    {% empty %}
      <p>まだレビューはありません</p>
    {% endfor %}

    {# 3件以上ある時だけ表示（押すと全件表示） #}
    {% if has_more %}
      <a href="{% url 'spotapp:review_detail' spot.spot_id %}?all=1" class="btn">
        もっと見る（全{{ total_reviews }}件）
      </a>
    {% endif %}

    <a href="{% url 'spotapp:review_create' spot.spot_id %}" class="btn">
      レビューを投稿する
    </a>

    <button type="button" onclick="history.back()">
      ← 戻る
    </button>
  </div>
  {% endblock %}
</div>
